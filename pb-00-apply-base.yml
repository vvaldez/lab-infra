- hosts: localhost
  connection: local
  gather_facts: no
  vars:
    vars_prompt_message: Confirm the environment to target
    vars_prompt_expected: "{{ datacenter }}-{{ named_env }}"
    vars_prompt_disable: "{{ disable_prompt | default('no') }}"
  roles:
    - vars-prompt
  tags:
    - always



- hosts: all
  tasks:
    - name: Setup networking by clearing existing NIC configs and placing new ones
      vars:
        # The network-scripts portion of the role is considered a provisioning
        # step. By default, it is not ran unless this is override to yes. When
        # re-running this role, it is probably not ideal to re-setup and restart
        # networking. Which will happen when setup_nics=yes.
        base_setup_nics: "{{ setup_nics | default('no') }}"
      block:
        - name: "Include network-scripts role to template
            /etc/sysconfig/network-scripts. Use `-e setup_nics=yes` to run."
          vars:
            network_scripts_dest_path: /etc/sysconfig/network-scripts
            network_scripts_nics: "{{ base.nics }}"
            network_scripts_clear_existing: yes
            network_scripts_restart: yes
          include_role:
            name: network-scripts
          when: "'nics' in base"

      when: base_setup_nics | bool
      tags:
        - network

    - vars:
        rhsm_server_hostname: "{{ base.subscription.rhsm_server_hostname }}"
        rhsm_org_id: "{{ base.subscription.rhsm_org_id }}"
        rhsm_activationkey: "{{ base.subscription.rhsm_activationkey }}"
        rhsm_repositories: "{{ base.subscription.rhsm_repositories }}"
      import_role:
        name: rhsm
      when: "base is defined and 'subscription' in base"
      tags:
        - subscription

    - import_role:
        name: base
      tags:
        - base
